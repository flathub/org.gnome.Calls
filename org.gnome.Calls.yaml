app-id: org.gnome.Calls
runtime: org.gnome.Platform
runtime-version: '42'
sdk: org.gnome.Sdk
command: gnome-calls
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --socket=pulseaudio
  - --share=network
  - --system-talk-name=org.freedesktop.ModemManager1
  - --talk-name=org.gnome.evolution.dataserver.AddressBook10
  - --talk-name=org.gnome.evolution.dataserver.Sources5
  - --talk-name=im.pidgin.purple.PurpleService
  - --talk-name=org.gnome.evolution.dataserver.Subprocess.Backend.*
  - --talk-name=org.mobian_project.CallAudio
  - --talk-name=org.sigxcpu.Feedback
cleanup:
  - /include
  - /lib/pkgconfig
  - /man
  - /share/doc
  - /share/gtk-doc
  - /share/man
  - /share/pkgconfig
  - /share/aclocal
  - /share/vala
  - '*.la'
  - '*.a'
modules:
  - name: modem-manager
    config-opts:
      - --without-udev
      - --without-mbim
      - --without-qmi
      - --with-systemdsystemunitdir=/app/lib/systemd/system
      - --with-udev-base-dir=/app/lib/udev
    sources:
      - type: git
        url: https://gitlab.freedesktop.org/mobile-broadband/ModemManager.git
        tag: 1.18.10
        commit: 1338749739e0c01bdbc6ddf92388a781806ec3ac
        x-checker-data:
          type: git
          # NOTE tag 0.3 is not semantic versioning
          #version-scheme: semantic
          tag-pattern: ^([\d.]+)$
  - name: gsound
    buildsystem: meson
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/gsound.git
        tag: 1.0.3
        commit: 95d36d60cf53e0e7c5d5325e0f1f4fc765a611ae
        x-checker-data:
          type: git
          version-scheme: semantic
    modules:
      - shared-modules/libcanberra/libcanberra.json
  - name: libpeas
    buildsystem: meson
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/libpeas.git
        tag: libpeas-1.32.0
        commit: 41335bc31cb3e5ec75196e621bb244ca4d96f151
        x-checker-data:
          type: git
          tag-pattern: ^libpeas-([\d.]+)$
          # NOTE tag libpeas-1.23.90.1 is not semantic versioning
          #version-scheme: semantic
  - name: boost
    buildsystem: simple
    sources:
      - type: git
        url: https://github.com/boostorg/boost.git
        tag: boost-1.79.0
        commit: 5df8086b733798c8e08e316626a16babe11bd0d2
        x-checker-data:
          type: git
          tag-pattern: ^boost-([\d.]+)$
          version-scheme: semantic
    build-commands:
      - ./bootstrap.sh --prefix=${FLATPAK_DEST} --with-libraries=date_time,thread,system
      - ./b2 -j ${FLATPAK_BUILDER_N_JOBS} install
    cleanup:
      - /share
      - /bin
  - name: GTest
    buildsystem: cmake-ninja
    cleanup:
      - '*'
    sources:
      - type: git
        url: https://github.com/google/googletest.git
        tag: release-1.12.1
        commit: 58d77fa8070e8cec2dc1ed015d66b454c8d78850
        # Disable shallow clone as this repo will be reused for submodule of protobuf
        # BUG https://github.com/flathub/flathub/issues/3067
        disable-shallow-clone: true
        x-checker-data:
          type: git
          tag-pattern: ^release-([\d.]+)$
          version-scheme: semantic
  - name: protobuf
    cleanup:
      - protoc
      - /bin
      - /doc
      - /lib/plugins
    sources:
      - type: git
        url: https://github.com/protocolbuffers/protobuf.git
        tag: v21.2
        commit: 839b18b1ba42639fedecfd751102afcc5736b5d4
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
          # BUG https://github.com/flathub/flatpak-external-data-checker/issues/294
          #version-scheme: semantic
  - name: cmocka
    buildsystem: cmake
    builddir: true
    sources:
      - type: git
        url: https://gitlab.com/cmocka/cmocka.git
        tag: cmocka-1.1.5
        commit: f5e2cd77c88d9f792562888d2b70c5a396bfbf7a
        x-checker-data:
          type: git
          tag-pattern: ^cmocka-([\d.]+)$
  - name: libphonenumber
    buildsystem: cmake-ninja
    config-opts:
      - -DREGENERATE_METADATA=OFF
      - -DFETCHCONTENT_FULLY_DISCONNECTED=ON
      - -DFETCHCONTENT_SOURCE_DIR_ABSEIL-CPP=/run/build/libphonenumber/tools/abseil-cpp
      - -DABSL_PROPAGATE_CXX_STD=ON
      - -DABSL_ENABLE_INSTALL=ON
    sources:
      - type: git
        url: https://github.com/google/libphonenumber.git
        tag: v8.12.51
        commit: 80683407f4cb01839096988cf3d3dbce7511d231
        x-checker-data:
          type: git
          version-scheme: semantic
      - type: shell
        commands:
          - sed -i -e 's/\${\${NAME}_BIN}-NOTFOUND/\${NAME}_BIN-NOTFOUND/' cpp/CMakeLists.txt
      # See https://github.com/google/libphonenumber/pull/2762
      - type: patch
        path: fix-libphonenumber-build.patch
      # BUG https://github.com/google/libphonenumber/pull/2763
      - type: git
        url: https://github.com/abseil/abseil-cpp.git
        tag: '20220623.0'
        commit: 273292d1cfc0a94a65082ee350509af1d113344d
        x-checker-data:
          type: git
          tag-pattern: ^([\d.]+)$
        dest: tools/abseil-cpp
    subdir: cpp
  - name: libical
    cleanup:
      - /lib/cmake
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DCMAKE_INSTALL_LIBDIR=lib
      - -DBUILD_SHARED_LIBS:BOOL=ON
      - -DICAL_GLIB=true
      - -DGOBJECT_INTROSPECTION=true
      - -DICAL_GLIB_VAPI=true
      - -DICAL_BUILD_DOCS=false
    sources:
      - type: git
        url: https://github.com/libical/libical.git
        tag: v3.0.14
        commit: 098fb68688b853410daed96812a6fe0a22e0e15f
        x-checker-data:
          type: git
          # NOTE tag v0.48 is not semantic versioning...
          #version-scheme: semantic
          tag-pattern: ^v([\d.]+)$
  - shared-modules/intltool/intltool-0.51.json
  - name: evolution-data-server
    cleanup:
      - /share/GConf
    buildsystem: cmake-ninja
    config-opts:
      - -DENABLE_PHONENUMBER=ON
      - -DENABLE_DOT_LOCKING=OFF
      - -DENABLE_FILE_LOCKING=fcntl
      - -DENABLE_GOA=OFF
      - -DENABLE_GTK=ON
      - -DENABLE_GOOGLE=OFF
      - -DENABLE_VALA_BINDINGS=ON
      - -DENABLE_WEATHER=OFF
      - -DWITH_OPENLDAP=OFF
      - -DWITH_LIBDB=OFF
      - -DENABLE_INTROSPECTION=ON
      - -DENABLE_INSTALLED_TESTS=OFF
      - -DENABLE_GTK_DOC=OFF
      - -DENABLE_EXAMPLES=OFF
      - -DWITH_PHONENUMBER:PATH=/
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/evolution-data-server.git
        tag: 3.44.2
        commit: e01c792d9a1e0d2a798efdbe108a8057c141e001
        x-checker-data:
          type: git
          # NOTE tag 3.43.1.1 is not semantic versioning...
          #version-scheme: semantic
          tag-pattern: ^([\d.]+)$
  - name: gom
    buildsystem: meson
    config-opts:
      - -Denable-introspection=false
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/gom.git
        tag: '0.4'
        commit: 26816b74a29b9d2d8dc169ed2f9649a4a159bc7c
        x-checker-data:
          type: git
          tag-pattern: ^([\d.]+)$
  - name: folks
    buildsystem: meson
    cleanup:
      - /bin
    config-opts:
      - -Dtelepathy_backend=false
      - -Dinspect_tool=false
      - -Dimport_tool=false
      - -Dbluez_backend=false
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/folks.git
        tag: 0.15.5
        commit: c75c2a55f171ec778a78d3d510add6993b353487
        x-checker-data:
          type: git
          # NOTE tag 0.14 is not semantic versioning...
          #version-scheme: semantic
          tag-pattern: ^([\d.]+)$
  - name: feedbackd
    buildsystem: meson
    config-opts:
      - -Ddaemon=false
    sources:
      - type: git
        url: https://source.puri.sm/Librem5/feedbackd.git
        tag: v0.0.0+git20220520
        commit: 17c1c2aa24dbf3b9829bcfc3db38f633053c52f9
        x-checker-data:
          type: git
          tag-pattern: ^v0\.0\.0\+git([\d]{8})$
  - name: callaudiod
    buildsystem: meson
    sources:
      - type: git
        url: https://gitlab.com/mobian1/callaudiod.git
        tag: 0.1.4
        commit: a7ca6ce9d4c947f19c3f99ff2cab986c64434e57
        x-checker-data:
          type: git
          version-scheme: semantic
  - name: sofia-sip
    buildsystem: autotools
    sources:
      - type: git
        url: https://github.com/freeswitch/sofia-sip.git
        tag: v1.13.8
        commit: 756ab9b5c9370423489e0d6a27166863c7a57fef
        x-checker-data:
          type: git
          version-scheme: semantic
  - name: calls
    buildsystem: meson
    builddir: true
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/calls.git
        tag: '42.0'
        commit: 818757d918b37a50727ac10976d9891070e70f22
        x-checker-data:
          type: git
          tag-pattern: ^([\d.]+)$
          is-main-source: true
